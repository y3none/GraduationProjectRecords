# 3.17

#### **sys**_gettid

```rust
#[apply(syscall_instrument)]
pub fn sys_set_tid_address(tid_ptd: UserConstPtr<i32>) -> LinuxResult<isize> {
    let curr = current();
    curr.task_ext()
        .set_clear_child_tid(tid_ptd.address().as_ptr() as _);
    Ok(curr.id().as_u64() as isize)
}
```

加入sys_gettid，观察sys_set_tid_address，返回值为当前线程 ID，而gettid用于获取当前进程ID，因此模仿sys_set_tid_address完成sys_gettid：

```rust
#[apply(syscall_instrument)]
pub fn sys_gettid() -> LinuxResult<isize> {
    Ok(current().id().as_u64() as _)
}
```

但是运行时出现page fault：

![](../../asserts/day317-1.png ':class=myImageClass')
